# 3D-R2N2 ä»£ç æ•´ç†

## 1. LSTMå’ŒGRU

### 1.1 LSTM

> LSTMå•å…ƒæ˜¯RNNéšè—çŠ¶æ€æœ€æˆåŠŸçš„å®ç°ä¹‹ä¸€ã€‚LSTMå•å…ƒæ˜ç¡®æ§åˆ¶ä»è¾“å…¥åˆ°è¾“å‡ºçš„æµé‡ï¼Œå…è®¸ç½‘ç»œå…‹æœæ¶ˆå¤±çš„æ¢¯åº¦é—®é¢˜ã€‚
>
> å…·ä½“æ¥è¯´ï¼ŒLSTMå•å…ƒç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š

+ å­˜å‚¨å•å…ƒï¼ˆå­˜å‚¨å•å…ƒå’Œéšè—çŠ¶æ€)
+ æ§åˆ¶ä»è¾“å…¥åˆ°éšè—çŠ¶æ€ï¼ˆè¾“å…¥é—¨ï¼‰
+ ä»éšè—çŠ¶æ€åˆ°è¾“å‡ºçš„ä¿¡æ¯æµçš„ä¸‰ä¸ªé—¨ ï¼ˆè¾“å‡ºé—¨ï¼‰
+ ä»å‰ä¸€ä¸ªéšè—çŠ¶æ€åˆ°å½“å‰éšè—çŠ¶æ€ï¼ˆå¿˜è®°é—¨ï¼‰ã€‚
åœ¨æ—¶é—´tæ—¶æ–°è¾“å…¥ğ‘¥_ğ‘¡

#### 1.2 GRU

> GRUæ˜¯LSTMçš„ä¸€ä¸ªå˜ç§
>
> GRUçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ä¸æ ‡å‡†LSTMç›¸æ¯”è®¡ç®—é‡æ›´å°‘.åœ¨GRUä¸­ï¼Œæ›´æ–°é—¨æ§åˆ¶è¾“å…¥å’Œå¿˜è®°é—¨
> å¦ä¸€ä¸ªåŒºåˆ«æ˜¯åœ¨éçº¿æ€§å˜æ¢ä¹‹å‰åº”ç”¨å¤ä½é—¨ã€‚

## 2. é‡æ„è¿‡ç¨‹

> é‡‡ç”¨æ·±åº¦å­¦ä¹ ä»2Då›¾åƒåˆ°å…¶å¯¹åº”çš„3D voxelæ¨¡å‹çš„æ˜ å°„: é¦–å…ˆåˆ©ç”¨ä¸€ä¸ªæ ‡å‡†çš„CNNç»“æ„å¯¹åŸå§‹input image è¿›è¡Œç¼–ç ï¼› å†åˆ©ç”¨ä¸€ä¸ªæ ‡å‡† Deconvolution network å¯¹å…¶è§£ç ã€‚ ä¸­é—´ç”¨Long Short-Term Memoryï¼ˆLSTMæ˜¯RNNä¸­çš„ä¸€ç§ï¼‰è¿›è¡Œè¿‡æ¸¡è¿æ¥, LSTM å•å…ƒæ’åˆ—æˆ3Dç½‘æ ¼ç»“æ„, æ¯ä¸ªå•å…ƒæ¥æ”¶ä¸€ä¸ªfeature vector from Encoder and Hidden states of neighbors by convolutionï¼Œå¹¶å°†ä»–ä»¬è¾“é€åˆ°Decoderä¸­. è¿™æ ·æ¯ä¸ªLSTMå•å…ƒé‡æ„output voxelçš„ä¸€éƒ¨åˆ†ã€‚ æ€»ä¹‹ï¼Œé€šè¿‡è¿™æ ·çš„Encoder-3DLSTM-Decoder çš„ç½‘ç»œç»“æ„å°±å»ºç«‹äº†2D images -to -3D voxel model çš„æ˜ å°„.
![Overview](imgs/full_network.png)

## 3. LSTMçš„ä¼˜ç‚¹

ä½¿ç”¨åŸºäºLSTMçš„ç½‘ç»œçš„ä¸»è¦ä¼˜ç‚¹æ¥è‡ªäºå½“å¤šä¸ªè§†å›¾è¢«é¦ˆé€åˆ°ç½‘ç»œæ—¶æœ‰æ•ˆå¤„ç†å¯¹è±¡è‡ªé®æŒ¡çš„èƒ½åŠ›ã€‚ ç½‘ç»œé€‰æ‹©æ€§åœ°æ›´æ–°å¯¹åº”äºå¯¹è±¡çš„å¯è§éƒ¨åˆ†çš„å­˜å‚¨å™¨å•å…ƒã€‚ å¦‚æœåç»­è§†å›¾æ˜¾ç¤ºå…ˆå‰è‡ªé®æŒ¡ä¸”ä¸é¢„æµ‹ä¸åŒ¹é…çš„éƒ¨åˆ†ï¼Œåˆ™ç½‘ç»œå°†æ›´æ–°å…ˆå‰è¢«é®æŒ¡çš„éƒ¨åˆ†çš„LSTMçŠ¶æ€ï¼Œä½†ä¿ç•™å…¶ä»–éƒ¨åˆ†çš„çŠ¶æ€ã€‚

## 4. ç½‘ç»œæ¶æ„

> ç½‘ç»œæ¶æ„ï¼šæ¯ä¸ª3D-R2N2ç”±ç¼–ç å™¨ï¼ˆa 2D Convolutional Neural Network (2D-CNN)ï¼‰ï¼Œé€’å½’å•å…ƒï¼ˆ3D-LSTMï¼‰å’Œè§£ç å™¨ï¼ˆ 3D Deconvolutional Neural Network (3D-DCNN)ï¼‰ç»„æˆã€‚ åœ¨æ¯ä¸ªå·ç§¯å±‚ä¹‹åï¼Œæˆ‘ä»¬æ”¾ç½®LeakyReLUå±‚ç”¨äºéçº¿æ€§åŒ–ã€‚ ç¼–ç å™¨å°†127Ã—127å¤§å°çš„RGBå›¾åƒè½¬æ¢ä¸ºä½ç»´ç‰¹å¾ï¼Œç„¶åå°†å…¶é¦ˆé€åˆ°3D-LSTMã€‚ ç„¶åè§£ç å™¨è·å–3D-LSTMéšè—çŠ¶æ€å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ€ç»ˆä½“ç´ å ç”¨å›¾ã€‚ åœ¨æ¯ä¸ªå·ç§¯å±‚ä¹‹åæ˜¯LeakyReLUå±‚ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªç‰ˆæœ¬çš„3D-R2N2 :(é¡¶éƒ¨ï¼‰æµ…ç½‘ç»œå’Œï¼ˆåº•éƒ¨ï¼‰æ·±åº¦æ®‹ç•™ç½‘ç»œ

### 4.1 ç¼–ç å™¨2D-CNN

ä½¿ç”¨CNNå°†2Då›¾ç‰‡è½¬æ¢ä¸ºç‰¹å¾
æˆ‘ä»¬è®¾è®¡äº†ä¸¤ç§ä¸åŒçš„2D-CNNç¼–ç å™¨

+ æ ‡å‡†å‰é¦ˆCNN
+ æ·±åº¦æ®‹å·®ç‰ˆæœ¬CNNã€‚

> ç¬¬ä¸€ä¸ªç½‘ç»œç”±æ ‡å‡†å·ç§¯å±‚ï¼Œæ±‡é›†å±‚å’ŒleakyRELUçº¿æ€§å•å…ƒç»„æˆï¼Œåè·ŸFull-connectedå±‚ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ç¬¬ä¸€ä¸ªç½‘ç»œçš„æ·±åº¦æ®‹å·®ç‰ˆæœ¬ã€‚
>
> åœ¨æ ‡å‡†å·ç§¯å±‚ä¹‹é—´æ·»åŠ **æ®‹å·®è¿æ¥**æœ‰æ•ˆåœ°æ”¹å–„å¹¶åŠ é€Ÿäº†æ·±å±‚ç½‘ç»œçš„ä¼˜åŒ–è¿‡ç¨‹ã€‚é™¤äº†ç¬¬4å¯¹ä¹‹å¤–ï¼Œç¼–ç å™¨ç½‘ç»œçš„æ·±åº¦æ®‹å·®ç‰ˆæœ¬åœ¨æ¯2ä¸ªå·ç§¯å±‚ä¹‹åå…·æœ‰ç‰¹å¾æ˜ å°„è¿æ¥ã€‚ä¸ºäº†åŒ¹é…å·ç§¯åçš„é€šé“æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨1Ã—1å·ç§¯è¿›è¡Œæ®‹ä½™è¿æ¥ã€‚ç„¶åå°†ç¼–ç å™¨è¾“å‡ºå±•å¹³å¹¶ä¼ é€’åˆ°å®Œå…¨è¿æ¥çš„å±‚ï¼Œè¯¥å±‚å°†è¾“å‡ºå‹ç¼©æˆ1024ç»´ç‰¹å¾å‘é‡ã€‚

### 4.2 å¾ªç¯ï¼š3D-Convolutional LSTM

> æˆ‘ä»¬çš„3D-R2N2çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ä¸€ä¸ªrecurrenceæ¨¡å—ï¼Œå®ƒå…è®¸ç½‘ç»œä¿ç•™å®ƒçœ‹åˆ°çš„å†…å®¹å¹¶åœ¨çœ‹åˆ°æ–°å›¾åƒæ—¶æ›´æ–°å¯¹åº”å•å…ƒçš„å†…å®¹ã€‚
>
> ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç°æˆçš„LSTMç½‘ç»œã€‚ç„¶è€Œï¼Œåœ¨æ²¡æœ‰ä»»ä½•æ­£è§„åŒ–çš„æƒ…å†µä¸‹ï¼Œé¢„æµ‹å¦‚æ­¤å¤§çš„è¾“å‡ºç©ºé—´ï¼ˆ32Ã—32Ã—32ï¼‰å°†æ˜¯ä¸€ä¸ªéå¸¸å›°éš¾çš„ä»»åŠ¡ã€‚ 
>
> æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„æ¶æ„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º3D-Convolutional LSTMï¼ˆ3D-LSTMï¼‰ã€‚è¯¥ç½‘ç»œç”±ä¸€ç»„å…·æœ‰å—é™è¿æ¥çš„ç»“æ„åŒ–LSTMå•å…ƒç»„æˆã€‚ 3D-LSTMå•å…ƒä»¥3Dç½‘æ ¼ç»“æ„åœ¨ç©ºé—´ä¸Šåˆ†å¸ƒï¼Œæ¯ä¸ªå•å…ƒè´Ÿè´£é‡å»ºæœ€ç»ˆè¾“å‡ºçš„ç‰¹å®šéƒ¨åˆ†
>
> åœ¨3Dç½‘æ ¼å†…éƒ¨ï¼Œæœ‰ğ‘Ã—ğ‘Ã—ğ‘ä¸ª3D-LSTMå•ä½ï¼Œå…¶ä¸­Næ˜¯3D-LSTMç½‘æ ¼çš„ç©ºé—´åˆ†è¾¨ç‡ã€‚ç´¢å¼•ï¼ˆiï¼Œjï¼Œkï¼‰ï¼Œæ¯ä¸ª3D-LSTMå•å…ƒå…·æœ‰ç‹¬ç«‹çš„éšè—çŠ¶æ€â„ğ‘¡ã€‚
>
> é€šè¿‡å»é™¤å†—ä½™è¾“å‡ºé—¨ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘å‚æ•°çš„æ•°é‡ã€‚
>
> ç©ºé—´ç»“æ„åŒ–çš„3Då·ç§¯LSTMåªå…è®¸å…¶éšè—çŠ¶æ€â„ğ‘¡ï¼ˆğ‘–ï¼Œğ‘—ï¼Œğ‘˜ï¼‰å—åˆ°å…¶ç›¸é‚»3D-LSTMå•å…ƒçš„å½±å“ã€‚æ›´å…·ä½“åœ°ï¼Œç›¸é‚»è¿æ¥ç”±å·ç§¯å†…æ ¸å¤§å°å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨3Ã—3Ã—3å†…æ ¸ï¼Œåˆ™LSTMå•å…ƒä»…å—å…¶ç›´æ¥é‚»å±…çš„å½±å“ã€‚è¿™æ ·ï¼Œå•å…ƒå¯ä»¥å…±äº«æƒé‡ï¼Œå¹¶ä¸”ç½‘ç»œå¯ä»¥è¿›ä¸€æ­¥æ­£åˆ™åŒ–ã€‚

### 4.3 è§£ç å™¨Decoder

åœ¨æ¥æ”¶åˆ°è¾“å…¥å›¾åƒåºåˆ—ğ‘¥1ï¼Œğ‘¥2ï¼Œ...ï¼Œğ‘¥ğ‘‡ä¹‹åï¼Œ3D-LSTMå°†éšè—çŠ¶æ€pä¼ é€’ç»™è§£ç å™¨ï¼Œé€šè¿‡åº”ç”¨3Dè§£å·ç§¯ï¼Œéçº¿æ€§å’Œ3Dè§£æ± åŒ–æ¥å¢åŠ éšè—çŠ¶æ€åˆ†è¾¨ç‡ï¼Œç›´åˆ°å®ƒè¾¾åˆ°ç›®æ ‡è¾“å‡ºåˆ†è¾¨ç‡ã€‚

ä¸ç¼–ç å™¨ä¸€æ ·ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªç®€å•çš„è§£ç å™¨ç½‘ç»œï¼Œå…¶ä¸­åŒ…å«5ä¸ªå·ç§¯ã€‚
è¿˜æœ‰ä¸€ä¸ªæ·±åº¦æ®‹å·®ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«4ä¸ªæ®‹ä½™è¿æ¥åŠ ä¸Šæœ€ç»ˆçš„å·ç§¯å±‚ã€‚ åœ¨æ¿€æ´»è¾¾åˆ°ç›®æ ‡è¾“å‡ºåˆ†è¾¨ç‡çš„æœ€åä¸€å±‚ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ä½“ç´ å½¢å¼çš„softmaxå‡½æ•°å°†æœ€ç»ˆçš„activation Vè½¬æ¢ä¸ºåœ¨(i,j,k)ä½ç½®ä½“ç´ å­˜åœ¨çš„æ¦‚ç‡p(i,j,k)ã€‚

### 4.4 ä¸¢å¤±å±‚ï¼š3D ä½“ç´ å½¢å¼çš„softmax

ç½‘ç»œçš„æŸå¤±å‡½æ•°è¢«å®šä¹‰ä¸ºä½“ç´ äº¤å‰ç†µçš„æ€»å’Œã€‚ è®©æ¯ä¸ªä½“ç´ ï¼ˆiï¼Œjï¼Œkï¼‰çš„æœ€ç»ˆè¾“å‡ºä¸ºä¼¯åŠªåˆ©åˆ†å¸ƒ

```math
[1 - p_{(i, j, k)}, p_{(i, j, k)}]
```

å…¶ä¸­å¯¹è¾“å…¥çš„ä¾èµ–

```math
{X} = \{x_t\}_{t \in \{1,\ldots ,T\}}
```

è¢«çœç•¥ï¼Œå¹¶ä¸”ç›¸åº”çš„ç©ºé—´å æœ‰ç‡ä¸º

```math
y_{(i, j, k)} \in \{0, 1\}
```

åˆ™

```math
\begin{aligned} L(\mathcal {X}, y)&= \sum _{i,j,k} y_{(i, j, k)} \log (p_{(i, j, k)}) + (1 - y_{(i, j, k)}) \log (1 - p_{(i, j, k)}) \end{aligned}
```

## 5. å®ç°è¿‡ç¨‹

### 5.1æ•°æ®å¢å¼º

åœ¨è®­ç»ƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨3D CADæ¨¡å‹ç”Ÿæˆè¾“å…¥å›¾åƒå’Œå®å†µä½“ç´ å ç”¨å›¾ã€‚æˆ‘ä»¬é¦–å…ˆä½¿ç”¨é€æ˜èƒŒæ™¯æ¸²æŸ“CADæ¨¡å‹ï¼Œç„¶åä½¿ç”¨PASCAL VOC 2012æ•°æ®é›†ä¸­çš„éšæœºç‰©ä½“å¢å¼ºè¾“å…¥å›¾åƒã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç€è‰²æ¨¡å‹çš„é¢œè‰²å¹¶éšæœºç¿»è¯‘å›¾åƒã€‚ è¯·æ³¨æ„ï¼Œæ‰€æœ‰è§†ç‚¹éƒ½æ˜¯éšæœºé‡‡æ ·çš„ã€‚

### 5.2 è®­ç»ƒ

åœ¨è®­ç»ƒç½‘ç»œæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸å®šé•¿åº¦è¾“å…¥ï¼Œä»»é€‰ä»ä¸€ä¸ªå›¾åƒåˆ°ä»»æ„æ•°é‡çš„å›¾åƒã€‚
å•ä¸ªæ‰¹æ¬¡ä¸­çš„æ¯ä¸ªè®­ç»ƒæ ·æœ¬çš„è¾“å…¥é•¿åº¦ï¼ˆè§†å›¾çš„æ•°é‡ï¼‰ä¿æŒä¸å˜ï¼Œä½†æ˜¯ä¸åŒå°æ‰¹é‡çš„è®­ç»ƒæ ·æœ¬çš„è¾“å…¥é•¿åº¦éšæœºå˜åŒ–ã€‚
è¿™ä½¿ç½‘ç»œèƒ½å¤Ÿæ‰§è¡Œå•è§†å›¾å’Œå¤šè§†å›¾é‡å»ºã€‚
åœ¨è®­ç»ƒæœŸé—´ï¼Œæˆ‘ä»¬ä»…åœ¨è¾“å…¥åºåˆ—çš„æœ«å°¾è®¡ç®—æŸè€—ï¼Œä»¥ä¾¿èŠ‚çœè®¡ç®—èƒ½åŠ›å’Œå­˜å‚¨å™¨ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æµ‹è¯•æ—¶é—´æœŸé—´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æå–LSTMå•å…ƒçš„éšè—çŠ¶æ€æ¥è®¿é—®æ¯ä¸ªæ—¶é—´æ­¥çš„ä¸­é—´é‡å»ºã€‚

### 5.3 ç½‘ç»œ

è¾“å…¥å›¾åƒå¤§å°è®¾ç½®ä¸º127Ã—127ã€‚è¾“å‡ºä½“ç´ åŒ–é‡å»ºçš„å¤§å°ä¸º32Ã—32Ã—32ã€‚å®éªŒä¸­ä½¿ç”¨çš„ç½‘ç»œç»è¿‡60,000æ¬¡è¿­ä»£çš„è®­ç»ƒï¼Œæ‰¹é‡å¤§å°ä¸º36ï¼Œé™¤äº†[Res3D-GRU-3]ï¼ˆå‚è§è¡¨1ï¼‰ï¼Œå…¶éœ€è¦æ‰¹é‡å¤§å°ä¸º24ä»¥é€‚åˆNVIDIA Titan X GPUã€‚
å¯¹äºLeakyReLUå±‚ï¼Œleakæ–œç‡åœ¨æ•´ä¸ªç½‘ç»œä¸­è®¾ç½®ä¸º0.1ã€‚å¯¹äºåå·ç§¯ï¼Œæˆ‘ä»¬éµå¾ªä¸Šé¢ä¸­æå‡ºçš„è§£æ”¾æ–¹æ¡ˆã€‚æˆ‘ä»¬ä½¿ç”¨Theanoæ¥å®ç°æˆ‘ä»¬çš„ç½‘ç»œï¼Œå¹¶ä½¿ç”¨Adamæ¥å®ç°SGDæ›´æ–°è§„åˆ™ã€‚
æˆ‘ä»¬ä½¿ç”¨MSRAåˆå§‹åŒ–é™¤LSTMæƒé‡ä¹‹å¤–çš„æ‰€æœ‰æƒé‡ï¼Œå¹¶ä¸”å¯¹æ‰€æœ‰åå·®åˆå§‹åŒ–0.1ã€‚å¯¹äºLSTMæƒé‡ï¼Œæˆ‘ä»¬ä½¿ç”¨SVDæ¥åˆ†è§£éšæœºçŸ©é˜µå¹¶ä½¿ç”¨å½’ä¸€åŒ–çŸ©é˜µè¿›è¡Œåˆå§‹åŒ–ã€‚
å¥‡å¼‚å€¼åˆ†è§£ï¼ˆSGD,singular value decompositionï¼‰

[SGD](https://en.wikipedia.org/wiki/SDG)

## 6. ä»£ç é˜…è¯»

### 6.1 é‡å»ºè¿›ç¨‹å‡½æ•°

> lib.data_process.py.ReconstructionDataProcess.run line113

### 6.2 æ–‡ä»¶è·¯å¾„

> './ShapeNet/ShapeNetRendering/%category/%model_name/rendering/%2d.png'
> './ShapeNet/ShapeNetVox32/%category/%model_name/model.binvox'

```py
batch_img = np.zeros( # [n_views, batch_size, channel=3, img_h, img_w]
                (curr_n_views, self.batch_size, 3, img_h, img_w), dtype=theano.config.floatX)
batch_voxel = np.zeros( # [batch_size, n_vox=32, 2, n_vox=32, n_vox=32]
                (self.batch_size, n_vox, 2, n_vox, n_vox), dtype=theano.config.floatX)
```

> å…·ä½“è€Œè¨€ï¼Œä¸‡èƒ½é€¼è¿‘å®šç†è¡¨æ˜ï¼šåªè¦æœ‰è¶³å¤Ÿçš„éšè—èŠ‚ç‚¹ï¼Œå…·æœ‰çº¿æ€§è¾“å‡ºå±‚å’Œè‡³å°‘ä¸€ä¸ªå…·æœ‰ä»»ä½•â€œå‹ç¼©â€æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ï¼Œlogistic sigmoidï¼‰çš„éšè—å±‚çš„å‰é¦ˆç½‘ç»œå¯ä»¥ä»ä¸€ä¸ªæœ‰é™ç»´ç©ºé—´åˆ°å¦ä¸€ä¸ªæœ‰é™ç»´ç©ºé—´æœ‰ä»»æ„çš„éé›¶è¯¯å·®é€¼è¿‘ä»»ä½•æ³¢è±å°”å¯æµ‹å‡½æ•°ã€‚
> --ç¬¬198é¡µï¼ŒDeep Learningï¼Œ2016å¹´ã€‚
> æœ€åï¼Œä»¥ä¸‹æ˜¯ç”¨äºæè¿°ç¥ç»ç½‘ç»œå½¢çŠ¶å’Œèƒ½åŠ›çš„ä¸€äº›æœ¯è¯­ï¼š

+ å°ºå¯¸ï¼šæ¨¡å‹ä¸­çš„èŠ‚ç‚¹æ•°ã€‚
+ å®½åº¦ï¼šç‰¹å®šå±‚ä¸­çš„èŠ‚ç‚¹æ•°ã€‚
+ æ·±åº¦ï¼šç¥ç»ç½‘ç»œä¸­çš„å±‚æ•°ã€‚
+ èƒ½åŠ›ï¼šå¯ä»¥é€šè¿‡ç½‘ç»œé…ç½®å­¦åˆ°çš„å‡½æ•°çš„ç±»å‹æˆ–ç»“æ„ã€‚æœ‰æ—¶è¢«ç§°ä¸ºâ€œ è¡¨å¾èƒ½åŠ› â€ã€‚
+ æ¶æ„ï¼šç½‘ç»œä¸­å±‚å’ŒèŠ‚ç‚¹çš„å…·ä½“æ’åˆ—ã€‚

ä¸ºå°½å¯èƒ½é¿å…è®­ç»ƒæ—¶å‡ºç°â€œè¿‡æ‹Ÿåˆâ€ç°è±¡ï¼Œä¿è¯è¶³å¤Ÿé«˜çš„ç½‘ç»œæ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ï¼Œç¡®å®šéšå±‚èŠ‚ç‚¹æ•°çš„æœ€åŸºæœ¬åŸåˆ™æ˜¯ï¼šåœ¨æ»¡è¶³ç²¾åº¦è¦æ±‚çš„å‰æä¸‹å–å°½å¯èƒ½ç´§å‡‘çš„ç»“æ„ï¼Œå³å–å°½å¯èƒ½å°‘çš„éšå±‚èŠ‚ç‚¹æ•°ã€‚ç ”ç©¶è¡¨æ˜ï¼Œéšå±‚èŠ‚ç‚¹æ•°ä¸ä»…ä¸è¾“å…¥/è¾“å‡ºå±‚çš„èŠ‚ç‚¹æ•°æœ‰å…³ï¼Œæ›´ä¸éœ€è§£å†³çš„é—®é¢˜çš„å¤æ‚ç¨‹åº¦å’Œè½¬æ¢å‡½æ•°çš„å‹å¼ä»¥åŠæ ·æœ¬æ•°æ®çš„ç‰¹æ€§ç­‰å› ç´ æœ‰å…³ã€‚
åœ¨ç¡®å®šéšå±‚èŠ‚ç‚¹æ•°æ—¶å¿…é¡»æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š
ï¼ˆ1ï¼‰éšå±‚èŠ‚ç‚¹æ•°å¿…é¡»å°äºN-1ï¼ˆå…¶ä¸­Nä¸ºè®­ç»ƒæ ·æœ¬æ•°ï¼‰ï¼Œå¦åˆ™ï¼Œç½‘ç»œæ¨¡å‹çš„ç³»ç»Ÿè¯¯å·®ä¸è®­ç»ƒæ ·æœ¬çš„ç‰¹æ€§æ— å…³è€Œè¶‹äºé›¶ï¼Œå³å»ºç«‹çš„ç½‘ç»œæ¨¡å‹æ²¡æœ‰æ³›åŒ–èƒ½åŠ›ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å®ç”¨ä»·å€¼ã€‚åŒç†å¯æ¨å¾—ï¼šè¾“å…¥å±‚çš„èŠ‚ç‚¹æ•°ï¼ˆå˜é‡æ•°ï¼‰å¿…é¡»å°äºN-1ã€‚
(2) è®­ç»ƒæ ·æœ¬æ•°å¿…é¡»å¤šäºç½‘ç»œæ¨¡å‹çš„è¿æ¥æƒæ•°ï¼Œä¸€èˆ¬ä¸º2~10å€ï¼Œå¦åˆ™ï¼Œæ ·æœ¬å¿…é¡»åˆ†æˆå‡ éƒ¨åˆ†å¹¶é‡‡ç”¨â€œè½®æµè®­ç»ƒâ€çš„æ–¹æ³•æ‰å¯èƒ½å¾—åˆ°å¯é çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ 
æ€»ä¹‹ï¼Œè‹¥éšå±‚èŠ‚ç‚¹æ•°å¤ªå°‘ï¼Œç½‘ç»œå¯èƒ½æ ¹æœ¬ä¸èƒ½è®­ç»ƒæˆ–ç½‘ç»œæ€§èƒ½å¾ˆå·®ï¼›è‹¥éšå±‚èŠ‚ç‚¹æ•°å¤ªå¤šï¼Œè™½ç„¶å¯ä½¿ç½‘ç»œçš„ç³»ç»Ÿè¯¯å·®å‡å°ï¼Œä½†ä¸€æ–¹é¢ä½¿ç½‘ç»œè®­ç»ƒæ—¶é—´å»¶é•¿ï¼Œå¦ä¸€æ–¹é¢ï¼Œè®­ç»ƒå®¹æ˜“é™·å…¥å±€éƒ¨æå°ç‚¹è€Œå¾—ä¸åˆ°æœ€ä¼˜ç‚¹ï¼Œä¹Ÿæ˜¯è®­ç»ƒæ—¶å‡ºç°â€œè¿‡æ‹Ÿåˆâ€çš„å†…åœ¨åŸå› ã€‚å› æ­¤ï¼Œåˆç†éšå±‚èŠ‚ç‚¹æ•°åº”åœ¨ç»¼åˆè€ƒè™‘ç½‘ç»œç»“æ„å¤æ‚ç¨‹åº¦å’Œè¯¯å·®å¤§å°çš„æƒ…å†µä¸‹ç”¨èŠ‚ç‚¹åˆ é™¤æ³•å’Œæ‰©å¼ æ³•ç¡®å®šã€‚

**åœ¨äººå·¥ç¥ç»ç½‘ç»œä¸­ï¼Œä»…ä»…å½“æ•°æ®å¿…é¡»è¢«éçº¿æ€§åˆ†ç¦»çš„æ—¶å€™ï¼Œéšè—å±‚æ‰æ˜¯å¿…éœ€çš„.**

[äººå·¥ç¥ç»ç½‘ç»œä¸­ç©¶ç«Ÿä½¿ç”¨å¤šå°‘éšè—å±‚å’Œç¥ç»å…ƒ](https://segmentfault.com/a/1190000015920173)

### 6.3 æ–‡ä»¶ä¿¡æ¯æ•´ç†

main.pyæ˜¯ä¸»è¿è¡Œæ–‡ä»¶ï¼Œè¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼Œè¿è¡Œè®­ç»ƒæˆ–è€…æµ‹è¯• ç”±--testå‚æ•°å†³å®š

train_net.pyé‡Œé¢å…ˆè¿›è¡Œç½‘ç»œçš„åˆå§‹åŒ–ï¼Œä½¿ç”¨ä¸€ä¸ªsolveræ¥å°è£…æ•´ä¸ªnetï¼Œç„¶ååˆ›å»ºæ•°æ®è¯»å–è¿›ç¨‹é˜Ÿåˆ—
åŒ…æ‹¬ä¸¤ç»„å„15ä¸ªè¿›ç¨‹çš„è¿›ç¨‹é˜Ÿåˆ—

å¯¹æ•°æ®çš„å¤„ç†æ˜¯å…ˆè¯»å–jsonæ–‡ä»¶ jsonæ–‡ä»¶é‡Œé¢åŒ…å«äº†10ç§è¦è®­ç»ƒçš„ç±»ä»¥åŠä»–ä»¬çš„idå’Œç±»å

å°†categoryå’Œnameåšæˆå…ƒç¥–ï¼Œå°è£…æˆlistè¿”å›

def get_next_minibatch(self): data_process.py line 62

num_dataæŒ‡çš„æ‰€æœ‰çš„category_nameçš„æ•°ç›®

+ å°†category_nameçš„é¡ºåºæ‰“ä¹±ï¼Œæ¯æ¬¡è¯»å–batch_sizeä¸ªcate-name
+ åœ¨0-cfg.TRAIN.NUM_RENDERINGä¹‹é—´å–n_viewä¸ªæ•°ä½œä¸ºå›¾ç‰‡çš„ä¸‹æ ‡
+ è¯»å–n_viewå¼ å›¾ç‰‡ + 1ä¸ªvoxelçŸ©é˜µ

> x.shape # å›¾ç‰‡
> (curr_n_views, self.batch_size, 3, img_h, img_w)
> y.shape # ä½“ç´ çŸ©é˜µ
> (self.batch_size, 2, n_vox, n_vox, n_vox)

batch_voxel[batch_id, 0, :, :, :] = voxel_data < 1
batch_voxel[batch_id, 1, :, :, :] = voxel_data
åŸºæœ¬å°±æ˜¯å–å ä¸€ä¸ªæ˜¯trueä¸€ä¸ªæ˜¯false

### 6.4 losså‡½æ•°

æ±‚çš„æ˜¯åˆ†ç±»é—®é¢˜çš„äº¤å‰ç†µNLL

```math
L(\mathcal {X}, y) = \sum _{i,j,k} y_{(i, j, k)} \log (p_{(i, j, k)}) + (1 - y_{(i, j, k)}) \log (1 - p_{(i, j, k)})
```

## 7. æ·±åº¦æ®‹å·®ç½‘ç»œ

ç½‘ç»œçš„æ·±åº¦ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ
>å› ä¸ºCNNèƒ½å¤Ÿæå–low/mid/high-levelçš„ç‰¹å¾ï¼Œç½‘ç»œçš„å±‚æ•°è¶Šå¤šï¼Œæ„å‘³ç€èƒ½å¤Ÿæå–åˆ°ä¸åŒlevelçš„ç‰¹å¾è¶Šä¸°å¯Œã€‚å¹¶ä¸”ï¼Œè¶Šæ·±çš„ç½‘ç»œæå–çš„ç‰¹å¾è¶ŠæŠ½è±¡ï¼Œè¶Šå…·æœ‰è¯­ä¹‰ä¿¡æ¯ã€‚

ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•åœ°å¢åŠ ç½‘ç»œå±‚æ•°ï¼Ÿ
> å¯¹äºåŸæ¥çš„ç½‘ç»œï¼Œå¦‚æœç®€å•åœ°å¢åŠ æ·±åº¦ï¼Œä¼šå¯¼è‡´æ¢¯åº¦å¼¥æ•£æˆ–æ¢¯åº¦çˆ†ç‚¸ã€‚
>
>å¯¹äºè¯¥é—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯æ­£åˆ™åŒ–åˆå§‹åŒ–å’Œä¸­é—´çš„æ­£åˆ™åŒ–å±‚ï¼ˆBatch Normalizationï¼‰ï¼Œè¿™æ ·çš„è¯å¯ä»¥è®­ç»ƒå‡ åå±‚çš„ç½‘ç»œã€‚
>
>è™½ç„¶é€šè¿‡ä¸Šè¿°æ–¹æ³•èƒ½å¤Ÿè®­ç»ƒäº†ï¼Œä½†æ˜¯åˆä¼šå‡ºç°å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é€€åŒ–é—®é¢˜ï¼Œç½‘ç»œå±‚æ•°å¢åŠ ï¼Œä½†æ˜¯åœ¨è®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡å´é¥±å’Œç”šè‡³ä¸‹é™äº†ã€‚è¿™ä¸ªä¸èƒ½è§£é‡Šä¸ºoverfittingï¼Œå› ä¸ºoverfitåº”è¯¥è¡¨ç°ä¸ºåœ¨è®­ç»ƒé›†ä¸Šè¡¨ç°æ›´å¥½æ‰å¯¹ã€‚
>é€€åŒ–é—®é¢˜è¯´æ˜äº†æ·±åº¦ç½‘ç»œä¸èƒ½å¾ˆç®€å•åœ°è¢«å¾ˆå¥½åœ°ä¼˜åŒ–ã€‚
>ä½œè€…é€šè¿‡å®éªŒï¼šé€šè¿‡æµ…å±‚ç½‘ç»œ+ y=x ç­‰åŒæ˜ å°„æ„é€ æ·±å±‚æ¨¡å‹ï¼Œç»“æœæ·±å±‚æ¨¡å‹å¹¶æ²¡æœ‰æ¯”æµ…å±‚ç½‘ç»œæœ‰ç­‰åŒæˆ–æ›´ä½çš„é”™è¯¯ç‡ï¼Œæ¨æ–­é€€åŒ–é—®é¢˜å¯èƒ½æ˜¯å› ä¸ºæ·±å±‚çš„ç½‘ç»œå¹¶ä¸æ˜¯é‚£ä¹ˆå¥½è®­ç»ƒï¼Œä¹Ÿå°±æ˜¯æ±‚è§£å™¨å¾ˆéš¾å»åˆ©ç”¨å¤šå±‚ç½‘ç»œæ‹ŸåˆåŒç­‰å‡½æ•°ã€‚

## 8. ç½‘ç»œç»“æ„åˆ†æ

```py
input_size = (batch, 3, 127, 127)
n_convfilter = [96, 128, 256, 256, 256, 256]

1. input   -------->  conv1a(96*127*127)
2. conv1a  -------->  bn1a(96*127*127)
3. bn1a    -------->  conv1b(96*127*127)
4. conv1b  -------->  bn1b(96*127*127)

5. bn1b
```

## 10. æƒ³åˆ°çš„ä¼˜åŒ–

1. losså‡½æ•°çš„ä¼˜åŒ–---è®­ç»ƒé€Ÿåº¦çš„åŠ å¿«ï¼Œè®­ç»ƒæ•ˆæœçš„å˜åŒ–ï¼Ÿ
2. BNçš„ä¼˜åŒ– -------æ¶‰åŠè®­ç»ƒé€Ÿåº¦çš„åŠ å¿«
ã€ŠBatch Normalization: Accelerating Deep Network Training by  Reducing Internal Covariate Shiftã€‹
3. ~~dropoutå±‚ -----è¿‡æ‹Ÿåˆ~~
BNå±‚æœ¬èº«æœ‰è§£å†³éƒ¨åˆ†è¿‡æ‹Ÿåˆ
4. gan   ---------æ–°çš„ç½‘ç»œ è®­ç»ƒéš¾åº¦å¾ˆå¤§
5. æ¢¯åº¦ä¸‹é™ç®—æ³•çš„åŒºåˆ«---adamç®—æ³•è¦ä¸è¦å°è¯•
adamå­¦ä¹ ç‡çš„ä¼˜åŒ–
sgdæµ‹è¯•
6. lstmçš„ä¼˜åŒ–-------éš¾åº¦å¾ˆå¤§
[](https://zhuanlan.zhihu.com/p/34203833)
7. æ®‹å·®ç»“æ„çš„ä¼˜åŒ–-----å¯ä»¥è€ƒè™‘
[](https://www.jianshu.com/p/e58437f39f65)
ç›®å‰ç®€å•çš„conv+bn
å¯ä»¥è€ƒè™‘æ›´ç®€å•çš„ç›´æ¥bn

## 11.config.pyä¿®æ”¹

__C.TRAIN.NUM_ITERATION = 6000  # maximum number of training iterations
__C.TRAIN.VALIDATION_FREQ = 200
__C.TRAIN.NAN_CHECK_FREQ = 200
__C.TRAIN.LEARNING_RATES = {'2000': 1e-5, '6000': 1e-6}
__C.TRAIN.SAVE_FREQ = 1000  # weights will be overwritten every save_freq

--iter 2000 \ è®­ç»ƒæ¬¡æ•°ä¿®æ”¹
